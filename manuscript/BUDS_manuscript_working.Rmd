---
title     : "Socioeconomic status and adolescent brain responses to peer feedback: Testing impact on negative affect assessed outside of the lab"
shorttitle    : "SES & brain responses to peer feedback"

author: 
  - name    : "Brent I. Rappaport"
    affiliation : "1"
    corresponding : yes  # Define only one corresponding author
    address   : "680 N. Lakeshore Drive, Suite 1520, Chicago, IL 60611"
    email   : "brent.rappaport@northwestern.edu"
    role:   # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - "Conceptualization"
      - "Formal analysis"
      - "Methodology"
      - "Writing - Original draft"
      - "Writing - review & editing"
  - name    : "James E. Glazer"
    affiliation : "1"
    role:
      - "Methodology"
  - name    : "Allison M. Letkiewicz"
    affiliation : "1"
    role:
      - "Writing - review & editing"
  - name    : "Lilian Y. Li"
    affiliation : "1"
    role:
      - "Methodology"
      - "Writing - review & editing"
  - name    : "Madeline M. McGregor"
    affiliation : "1"
    role:
      - "Data curation"
      - "Project administration"
      - "Writing - original draft"
  - name    : "Sarah E. Sarkas"
    affiliation : "1"
    role:
      - "Data curation"
      - "Project administration"
  - name    : "Aishwarya Sritharan"
    affiliation : "2"
    role:
      - "Data curation"  
      - "Project administration"
  - name    : "Lili A. Massac"
    affiliation : "2"
    role:
      - "Data curation"
      - "Project administration"
      - "Writing - original draft"
  - name    : "Katherine Durham"
    affiliation : "2"
    role:
      - "Project administration"
  - name          : "Randy Auerbach"
    affiliation   : "2"
    role:
      - "Conceptualization"
      - "Funding acquisition"
      - "Investigation"
      - "Methodology"
      - "Resources"
      - "Supervision"
      - "Writing - review & editing"
  - name          : "Stewart A. Shankman"
    affiliation   : "1"
    role:
      - "Conceptualization"
      - "Funding acquisition"
      - "Investigation"
      - "Methodology"
      - "Resources"
      - "Supervision"
      - "Writing - review & editing"

affiliation:
  - id    : "1"
    institution : "Stephen M. Stahl Center for Psychiatric Neuroscience, Department of Psychiatry and Behavioral Sciences, Feinberg School of Medicine, Northwestern University"
  - id    : "2"
    institution : "Department of Psychiatry, Columbia University"

abstract: |
  *Background:* Lower socioeconomic status (SES) is a potent risk factor for psychopathology in youth. Because lower SES youth experience greater prejudice, discrimination, and stigma (which collectively, reflect a lack of acceptance from others), one neural mechanism that may link SES to psychopathology risk is aberrant brain responding to accepting feedback. This study tests whether SES (operationalized as neighborhood area deprivation) is: 1) related to brain responses to peer feedback, and 2) moderates the relationship between brain responses to peer feedback and affect outside of the lab, measured through experience momentary assessment (EMA). *Methods:* Adolescents (N=172; ages 13-18 were administered an event-related potential (ERP) task during which they received accepting or rejecting feedback from peers to probe their neural response to acceptance (relative to rejection) via the reward positivity (RewP) and P300 ERP components. Participants additionally completed a week of EMA reporting on their positive and negative affect. *Results:* Lower SES was related to blunted responses to acceptance (in the RewP and P300, relative to rejection), independent of depression and anxiety symptoms. Interestingly, lower SES moderated relationships between brain responses (RewP and P300) to peer acceptance and negative affect, with adolescents with lower SES exhibiting a more negative relationship between EMA reported negative affect and brain response to acceptance than adolescents with higher SES. *Conclusions:* SES may be linked to psychopathology via blunted response to acceptance. These findings suggest that prevention and intervention efforts targeting bias to social feedback may reduce risk for psychopathology particularly in low SES youth.
  
keywords    : "social feedback, socioeconomic status, area deprivation, negative affect, event-related potential, ecological momentary assessment"

bibliography  : "BUDS.bib"
floatsintext  : yes
linenumbers   : no
draft         : no
mask          : no
figurelist    : no
tablelist     : no
footnotelist  : no
classoption   : "man, donotrepeattitle"
csl     : 'biological-psychiatry.csl'
# csl     : 'apa7.csl'
documentclass   : "apa7"
output        : papaja::apa6_word
  
editor_options: 
  markdown: 
  wrap: sentence
  
header-includes:
  - \usepackage{setspace}
  - \AtBeginEnvironment{tabular}{\singlespacing}
  - \AtBeginEnvironment{lltable}{\singlespacing}
  - \addtolength{\tabcolsep}{6pt}
  - \AtBeginEnvironment{tablenotes}{\doublespacing}
  - \captionsetup[table]{font={stretch=1.5}}
  - \captionsetup[figure]{font={stretch=1.5}}
  
  - \raggedbottom
  
  - \usepackage{helvet}
  - \renewcommand{\rmdefault}{phv} % Use Helvetica for serif
  - \renewcommand{\sfdefault}{phv} % Use Helvetica for sans-serif
---

```{r analysis-preferences}
knitr::opts_chunk$set(set.seed(312), warning=FALSE, message=FALSE, include=FALSE, results='hide')
  options(width=80, Ncpus = 6, mc.cores=6, max.print=1000000, scipen = 999) #Set width, multiple cores, and not to use scientific notation
  rm(list=ls())   #Remove everything from environment
  cat("\014")   #Clear Console

  # library(knitr)  #allows rmarkdown files
  library(haven)  #helps import stata
  library(expss)  #labeling variables/values
  library(broom.mixed)  #nice statistical output
  library(here)   #nice file paths
  library(psych)  #used for statistical analyses
  library(Hmisc)
  library(purrr)
  library(haven)  #to import SPSS files
  library(MASS)   #to create residualized scores
# Models
  library(lsr) # Cohens D
  library(lmerTest)
  library(glmmTMB)
# Plotting
  library(ggplot2)  #creates plots
  library(ggpubr)
  library(ggeffects)
  library(sjPlot)
  library(sjPlot)
  library(marginaleffects)
  library(interactions)
  library(latex2exp)
  library(emmeans) # testing simple slopes

  library(datawizard)
  library(performance)
  library(xfun)
  library(Rmisc)
  library(vtable)
# General tools
  library(tidyverse)  #plotting/cleaning, etc.
  library(scipub) #demo table
  library(r2symbols) # symbols inline text
  library(papaja)
  library(workflowr)  #helps with workflow
  library(dplyr)

here <- here::here
here::i_am("BUDS_manuscript_working.Rmd")

select <- dplyr::select
filter <- dplyr::filter

r_refs("BUDS.bib")
```

```{r Load data}
load(file=here::here("../data/BUDS_do02.RData")) # ERP and self-report data
load(file=here("../data/BUDS_behavior.RData")) # ERP behavioral data
load(file=here("../data/BUDS_do03_gaplots.RData")) # Grand average data
spearman_brown <- read.csv(file=here("../tables/spearman_brown.csv")) # Internal consistency table
```

```{r Functions}
round3 <- function(var) {
  sprintf("%.3f",var)
}

# Make my own apa_printlm function that does not include t stats
add_equals2 <- function(p_value) {
  for (p in p_value) {
    if (p < 0.001) {
      return("< 0.001")
    } else {
      return(paste0("=", format(p_value, digits = 2, nsmall =2)))
    }
  }
}

apa_printlm <- function(model) {
  glue_apa_results(broom::tidy(model, conf.int = TRUE)
    , est_glue = "$\\beta$=<<estimate>>, 95% CI [<<conf.low>>,<<conf.high>>]"
    , stat_glue = "*p*<<add_equals2(p.value)>>"
    , term_names = sanitize_terms(make.names(names(coef(model))))
)
}

# from https://www.r-bloggers.com/2020/07/create-a-publication-ready-correlation-matrix-with-significance-levels-in-r/

correlation_matrix <- function(df,
           type = "pearson",
           digits = 3,
           decimal.mark = ".",
           use = "all",
           show_significance = TRUE,
           replace_diagonal = FALSE,
           replacement = ""){
  
  # check arguments
  stopifnot({
  is.numeric(digits)
  digits >= 0
  use %in% c("all", "upper", "lower")
  is.logical(replace_diagonal)
  is.logical(show_significance)
  is.character(replacement)
  })
  # we need the Hmisc package for this
  require(Hmisc)
  
  # retain only numeric and boolean columns
  isNumericOrBoolean = vapply(df, function(x) is.numeric(x) | is.logical(x), logical(1))
  if (sum(!isNumericOrBoolean) > 0) {
  cat('Dropping non-numeric/-boolean column(s):', paste(names(isNumericOrBoolean)[!isNumericOrBoolean], collapse = ', '), '\n\n')
  }
  df = df[isNumericOrBoolean]
  
  # transform input data frame to matrix
  x <- as.matrix(df)
  
  # run correlation analysis using Hmisc package
  correlation_matrix <- Hmisc::rcorr(x, type = )
  R <- correlation_matrix$r # Matrix of correlation coeficients
  p <- correlation_matrix$P # Matrix of p-value
  
  # transform correlations to specific character format
  Rformatted = formatC(R, format = 'f', digits = digits, decimal.mark = decimal.mark)
  
  # if there are any negative numbers, we want to put a space before the positives to align all
  if (sum(R < 0) > 0) {
  Rformatted = ifelse(R > 0, paste0(' ', Rformatted), Rformatted)
  }
  
  # add significance levels if desired
  if (show_significance) {
  # define notions for significance levels; spacing is important.
  stars <- ifelse(is.na(p), " ", ifelse(p < .001, "***", ifelse(p < .01, "** ", ifelse(p < .05, "*  ", " "))))
  Rformatted = paste0(Rformatted, stars)
  }
  # build a new matrix that includes the formatted correlations and their significance stars
  Rnew <- matrix(Rformatted, ncol = ncol(x))
  rownames(Rnew) <- colnames(x)
  colnames(Rnew) <- paste(colnames(x), "", sep =" ")
  
  # replace undesired values
  if (use == 'upper') {
  Rnew[lower.tri(Rnew, diag = replace_diagonal)] <- replacement
  } else if (use == 'lower') {
  Rnew[upper.tri(Rnew, diag = replace_diagonal)] <- replacement
  } else if (replace_diagonal) {
  diag(Rnew) <- replacement
  }
  
  return(Rnew)
}

lmer_adi_interaction_table <- function(data) {
  new_model <- data.frame(model = c("Both","Acc","Rej"),
          beta = NA, 
          p = NA)
new_model$beta <- c(broom.mixed::tidy(lmer(formula = ERP ~ Feedback*Voting*ADI_NATRANK_c + (1 | ID), REML=TRUE, data = data))[8,4], broom.mixed::tidy(lmer(formula = ERP ~ Feedback*ADI_NATRANK_c + (1 | ID), REML=TRUE, data = filter(data, Voting=="Acc")))[4,4],
        broom.mixed::tidy(lmer(formula = ERP ~ Feedback*ADI_NATRANK_c + (1 | ID), REML=TRUE, data = filter(data, Voting=="Rej")))[4,4])

new_model$p <- c(broom.mixed::tidy(lmer(formula = ERP ~ Feedback*Voting*ADI_NATRANK_c + (1 | ID), REML=TRUE, data = data))[8,8], broom.mixed::tidy(lmer(formula = ERP ~ Feedback*ADI_NATRANK_c + (1 | ID), REML=TRUE, data = filter(data, Voting=="Acc")))[4,8],
        broom.mixed::tidy(lmer(formula = ERP ~ Feedback*ADI_NATRANK_c + (1 | ID), REML=TRUE, data = filter(data, Voting=="Rej")))[4,8])
new_model
}

plot_stats <- function(model, var) {
  temp_stats <- tidy(model) %>% 
  dplyr::filter(term==var) %>%
  dplyr::select(estimate,p.value) %>%
  round(., 3)
  paste0("b = ", temp_stats[1], ", p = ", temp_stats[2])
}

make_long_format <- function(data, site_variable) {
  data %>%
    pivot_longer(cols=c("Acc_Acc","Rej_Acc","Acc_Rej","Rej_Rej"), names_to=c("Voting","Feedback"), names_sep="_", values_to="ERP")
}
```

Low socioeconomic status (SES) in adolescence is a known correlate [@mclaughlinSocioeconomicStatusAdolescent2012; @peverillSocioeconomicStatusChild2021] and longitudinal predictor of psychopathology and general health problems into adulthood [@ferraroChildhoodDisadvantageHealth2016; @santiagoSocioeconomicStatusNeighborhood2011]. Yet, not all adolescents who experience low SES will develop mental illness. Thus, it is imperative to identify factors which could help explain why some low SES youth develop mental illness, while others do not. This study examines whether one potential factor—neural processing of social feedback from peers—interacts with SES to influence an individual’s affect.

Fulfilling peer relationships in adolescence are a robust predictor of long term mental health and functioning [@landstedtHowWellParental2015; @adedejiPeerRelationshipsDepressive2022]. However, compared to higher SES youth, lower SES youth experience greater discrimination and stigma from others [@cozzarelliAttitudesPoorAttributions2001; @mouraStigmatizationPovertyBasis2019], which can lead to difficulty being trusting and intimate with others [@rokachChapter11Implications2023; @nesdalePeerRejectionChildhood2013]. As such, low SES adolescents may develop a bias to feedback from others [@simonsRelationalSchemasHostile2012; @simonsLearningBeBad2011], including anhedonic responses to positive feedback (i.e., acceptance). Over time, these biases can lead to social withdrawal and mental health problems [@ikeSocialWithdrawalInitially2020].

One way to objectively measure anhedonic responses to acceptance is with event-related potentials (ERPs)—fluctuations in electroencephalography (EEG) signals that are time-locked to the presentation of events such as accepting relative to rejecting feedback. Unlike other neural measures (e.g., fMRI), ERPs have high temporal resolution (on the order of milliseconds) making them ideal for disambiguating neuropsychological responses to peer feedback. For example, the reward positivity [RewP, @proudfitRewardPositivityBasic2015] is an ERP that occurs around 250ms post feedback and likely reflects neural activity to the rewarding aspects of accepting, relative to rejecting, feedback [@funkhouserSocialFeedbackValence2020; @ethridgeNeuralResponsesSocial2017]. A second ERP is the P300, which occurs slightly later (around 300-400ms post feedback) and indexes the salience of acceptance feedback [i.e., the degree to which participants find peer acceptance salient or important, @funkhouserSocialFeedbackValence2020; @peggTimeCourseReactivity2022]. The RewP and P300 can therefore be used to index individual differences in separate brain responses to social feedback [@brownNovelRewardsOcclude2020].

Prior studies have established relationships between SES and psychopathology as well as brain responses to peer feedback and psychopathology in adolescents [@mclaughlinSocioeconomicStatusAdolescent2012; @peverillSocioeconomicStatusChild2021; @ferraroChildhoodDisadvantageHealth2016; @santiagoSocioeconomicStatusNeighborhood2011]. However, only one study tested whether SES was related to brain responses to peer feedback, with findings showing that lower SES (i.e., income relative to family size) was related to blunted brain responses to peer acceptance in late adolescents/young adults [17—18-year-olds, @rappaportBehavioralPsychiatricCorrelates2024a]. The current study expands upon this one study two ways. First, we use an objective, comprehensive measure of SES [area deprivation index [ADI], @kindMakingNeighborhooddisadvantageMetrics2018; @kindNeighborhoodSocioeconomicDisadvantage2014; @knightonIntroductionAreaDeprivation2016] derived from census data, and focus more centrally on adolescents (age 13—18) to further test whether adolescents with low SES exhibit more blunted brain responses (i.e., RewP and P300) to peer acceptance than high SES adolescents. Second, we examined whether low SES interacts with neural biases to peer feedback at predicting elevated negative affect outside of the lab, to test the hypotheses that those with both low SES and blunted neural response to acceptance would be particularly likely to report elevated negative affect measured outside of the lab.

# Methods and Materials

## Participants

Participants (N=172) were from a larger, ongoing project examining social processing deficits in adolescent depression. Adolescents, ages 13-18-years-old, were recruited from the community and mental health clinics in New York, NY and Chicago, IL. All study procedures were conducted in accordance with the Declaration of Helsinki and approved by the New York State Psychiatric Institute and Northwestern University Institutional Review Boards. Table 1 summarizes the participant demographic and clinical characteristics. Informed assent and consent were obtained from the adolescent and parent, respectively, and adolescents 18 years-old provided consent. General inclusion criteria included: (a) Tanner Pubertal Stage ≥ 3 (1), (b) parental and child fluency in English, (c) Wechsler Abbreviated Scale of Intelligence-II (WASI-II) \> 85 (2), (d) ownership of a personal smartphone (android or iOS), and (e) right-handedness. General exclusion criteria included: (a) history of head injury or neurological disorders, (b) current moderate or severe substance use disorder, and (c) lifetime history of bipolar or psychotic disorders, oppositional defiant disorder, conduct disorder, organic mental disorder, or developmental disorder.

## Procedure

### Brain response to acceptance: Social feedback EEG task

Brain activity to social feedback was measured using the Chatroom Task [@guyerAmygdalaVentrolateralPrefrontal2008; @guyerProbingNeuralCorrelates2009] which was completed over two visits. On the first visit, participants were told that they were participating in a multi-site study on adolescent interactions online. Participants created profiles including their hobbies and things about them (e.g., favorite food) and were told that other participants would review their profile and indicate interest (acceptance) or not (rejection) in chatting with them. Next, participants viewed photographs of 50 male and 50 female peers and selected 50 that they were ‘interested’ (high value) and 50 that they were ‘not interested’ (low value) in chatting with online following the second visit. On the second visit (\~1 week later), participants were presented with the “results” showing whether each of the 100 peers were interested in chatting with them or not while EEG data were recorded. Each of the 100 trials included: (a) photograph of the peer and a reminder of participants’ prior choice (2000ms, i.e., ‘You were [not] interested’), (b) fixation cross for a jittered inter-stimulus interval (1000ms), and (c) green check or red ‘X’, indicating whether the peer was ‘Interested’ or ‘Not Interested,’ respectively, (i.e., accepting and rejecting feedback, 2000ms, Figure 1A). After each trial, participants rated their emotional response on a sliding scale from 0-100 from ‘very bad’ to ‘very good.’ Trials were pseudo-randomized with no more than two sequential acceptances/rejections. Participants received 50 acceptance and 50 rejection trials — split by participant interest in the peer (e.g., 25 peers that participants were interested in, and accepted by). After completing the task, participants’ belief in the task was assessed, and then, participants were debriefed. The task therefore has four within-subject conditions: 1) acceptance from high-value peers (i.e., peers that participants were interested in talking to), 2) rejection from high-value peers, 3) acceptance from low-value peers (i.e., peers that participants were not interested in talking to), and 4) rejection from low-value peers.

### EEG recording and processing

Continuous EEG data were recorded during the Chatroom task using the 32-channel ActiCHamp from Brain Products (Brain Products, Munich, Germany), digitized at a 500 Hz sampling rate, and referenced online to FCz. Vertical and horizontal EOG data were recorded, and electrode impedances were maintained below 20 K$\Omega$. EEG data were processed offline using EEGLAB version 2022.1 [@delormeEEGLABOpenSource2004] and ERPLAB version 9.00 [@lopez-calderonERPLABOpensourceToolbox2014] toolboxes in MATLAB version r2022b. Independent component analysis (ICA) and automated identification (ICLabel version 1.4) was used to identify and correct for ocular artifacts prior to artifact rejection. Data were re-referenced offline using an average mastoid reference. A 60Hz notch filter and a second-order digital Butterworth filter with a bandpass from 0.1–30Hz were applied. Trials were epoched from -200–2000ms from the feedback and baseline-adjusted by subtracting the average amplitude for 200ms prior to the feedback onset (-200–0ms).

Feedback-locked ERPs were averaged separately for each combination of peer value (high, low) and feedback type (acceptance, rejection). Grand averages were inspected to determine time windows to be extracted (Figure 1B). Time windows were chosen based on those windows which showed substantial difference between conditions, and/or were consistent with prior literature [@donaldsonTemporalDynamicsReversal2016; @funkhouserSocialFeedbackValence2020; @peggTimeCourseReactivity2022]. For the RewP and P300, time windows of 150—275ms and 275—425ms were used, respectively. For the RewP, mean amplitude of the difference between acceptance and rejection was maximal at Cz. For the P300, topographic maps of the difference between conditions did not show a clear maximal electrode in the time window. Therefore, the maximal electrode for the P300 (Pz) was based on prior literature [@funkhouserSocialFeedbackValence2020].

```{r}
segments_df <- read.csv(here::here("../data/eeg_processing/SegmentCount/summary_erp_bin_RewP.csv")) %>%
  rename_with(~ paste0(., "_seg")) %>%
  mutate(ID = subject_seg) %>%
  select(-subjCount_seg, -subject_seg)

too_few_trials <- function(data, acceptance_trials, rejection_trials) {
  x <- full_join(segments_df,data,by="ID") %>%
    filter(Acc_Acc_seg < acceptance_trials | Acc_Rej_seg < rejection_trials)
  length(x$ID)
}

# sum(complete.cases(df_50150_fz$Acc_Acc) & complete.cases(df_50150_fz$Acc_Rej))
# sum(complete.cases(df_150275_cz$Acc_Acc) & complete.cases(df_150275_cz$Acc_Rej))
# sum(complete.cases(df_275425_pz$Acc_Acc) & complete.cases(df_275425_pz$Acc_Rej))
# 
# too_few_trials(df_50150_fz, 0, 0)
# too_few_trials(df_150275_cz, 13, 11)
# too_few_trials(df_275425_pz, 15, 13)
```

#### Reliability of ERPs

```{r}
spearman_brown <-spearman_brown %>%
  dplyr::select(-X) %>%
  filter(!Time_windows=="Fz 50-150ms")
```

The RewP and P300 demonstrated acceptable levels of internal consistency across peer-value (high, low) and feedback conditions (acceptance, rejection), with split-half reliability (*r*) \> `r min(select(spearman_brown, c("Acc_Acc","Acc_Rej","Rej_Acc","Rej_Rej")))`, with particularly high reliability for the high-value peers conditions (acceptance *r* = `r select(spearman_brown, c("Acc_Acc"))[1,]` and `r select(spearman_brown, c("Acc_Acc"))[2,]`, and rejection *r* = `r select(spearman_brown, c("Acc_Rej"))[1,]` and `r select(spearman_brown, c("Acc_Rej"))[2,]`, for RewP and P300, respectively). Split-half reliability was considerably lower for the residualized scores, but remained comparable to other studies (RewP~resid~ *r*\>`r select(spearman_brown, "AA_AR")[1,]`, P3~resid~ *r*\>`r select(spearman_brown, "AA_AR")[2,]`) [@rappaportBehavioralPsychiatricCorrelates2024a; @ethridgePsychometricPropertiesNeural2018; @levinsonReliabilityElectrocorticalResponse2017]. See Supplement for full results.

In dependability analyses (another form of reliability), the RewP and P300 achieved acceptable dependability ($\ge$ 0.70) with as few as 12—13 and 13—15 trials, respectively, depending on the peer-value and feedback condition. When using all available trials, up to 25 trials per condition, RewP and P300 achieved good dependability ($\ge$ 0.80; see Supplement). Based on these dependability analyses `r length(dplyr::filter(segments_df, Acc_Acc_seg < 13 | Acc_Rej_seg < 11)$ID)` subjects were excluded for having too few clean trials for the RewP and `r length(dplyr::filter(segments_df, Acc_Acc_seg < 15 | Acc_Rej_seg < 13)$ID)` for the P300 following artifact rejection. This resulted in different samples sizes per component: RewP (n=`r sum(complete.cases(df_150275_cz$Acc_All),na.rm=T)`) and P300 (n=`r sum(complete.cases(df_275425_pz$Acc_All),na.rm=T)`).

### Ecological momentary assessment (EMA)

```{r}
subjects_with_less_than_4_responses <- read.csv(file=here::here("../data/number_with_less_than_4_EMA_responses.csv"))
```

Ecological momentary assessment data were collected using the Effortless Assessment of Risk States (EARS) app [@lindEffortlessAssessmentRisk2018; @lindReintroducingEffortlessAssessment2023] for 7 days after consenting into the study. Participants received three notifications each day (between 6:30am-8:30am, 3:00pm-5:00pm, and 7:00-10:00pm) to rate their current mood; specifically rating positive and negative affect items on a scale from 0 (*not at all*) to 100 (*extremely*). Positive affect reflected the sum of “happy,” “excited,” and “supported” items, whereas negative affect reflected the sum of “angry,” “anxious,” “sad,” and “rejected” items. List-wise deletion was used such that if, for example, “sad” was skipped, the negative affect composite score was missing for that participant at that time point; however, multilevel models, such as those used in these analyses, accommodate missing data in the dependent variable [@wuAnticipatoryConsummatoryPleasure2017]. Participants were compensated \$1 for every completed set of questions for a maximum of \$3 per day and \$21 total over the course of a week. `r n2w(length(subjects_with_less_than_4_responses$subject_id), cap=TRUE)` participants were excluded for having made too few EMA responses [\<4, @thompsonEverydayEmotionalExperiences2021].

## Measures

### SES: Area Deprivation Index (ADI)

The area deprivation index [2021 version 4.0.1, @kindMakingNeighborhooddisadvantageMetrics2018; @universityofwisconsinschoolofmedicineandpublichealthAreaDeprivationIndex2023] is a composite measure based on 17 dimensions of socioeconomic disadvantage for an individual’s neighborhood including education, employment, housing quality, and poverty-related factors, all measured via the American Community Survey. Neighborhoods are determined based on block groups and are assigned a percentile from 1 to 100, where a higher percentile indicates greater levels of neighborhood disadvantage. In cases when ADI values were missing (e.g., inability to accurately estimate ADI in block groups where an unusually large number of people lived), it was estimated using the ADI of the nearest block group with available data (often \<1 mile from the original address). Adolescents living on college campuses provided their most recent non-college address; however, for four participants these addresses were outside of the USA or could not be obtained, and thus their college address was used. ADI percentile was reverse scored so that higher scores represented greater SES.

### Covariates

#### Depression and anxiety symptoms

```{r}
idas_dep <- formatC(psych::alpha(df_275425_pz[,c("idas_1_i","idas_2_i","idas_5_i","idas_6_i","idas_8_i","idas_9_i","idas_11_i","idas_13_i","idas_21_i","idas_26_i","idas_30_i","idas_31_i","idas_40_i","idas_48_i","idas_51_i","idas_52_i","idas_57_i","idas_61_i")])$total$std.alpha,format="f",2)
idas_anx <- formatC(psych::alpha(df_275425_pz[,c("idas_7_i","idas_16_i","idas_32_i","idas_39_i","idas_45_i","idas_49_i","idas_56_i","idas_58_i","idas_15_i","idas_18_i","idas_20_i","idas_41_i","idas_47_i","idas_99_i")])$total$std.alpha,format="f",2)
```

The expanded Inventory of Depression and Anxiety Symptoms [IDAS-II, @watsonDevelopmentValidationNew2012] is a 99-item, self-report instrument that measures the severity of depression, anxiety, and bipolar disorder symptoms over the past two weeks. Items are scored on a 5-point scale (1=not at all; 5=extremely). For the present study, 52-items were selected to assess current depression and anxiety symptoms. The depression (Cronbach's $\alpha$ = `r idas_dep`) and anxiety (a combination of the panic and social anxiety subscales; Cronbach's $\alpha$ = `r idas_anx`) demonstrated excellent internal consistency.

#### Stressful life events

The Stress and Adversity Inventory for Adolescents [STRAIN, @slavichStressAdversityInventory2019] was administered to measure participants’ exposure to stressors over their lifetime. This interview assesses exposures to 75 different stressors across 12 primary life domains (e.g., education, parent/guardian, death, life-threatening situations) and five social-psychological characteristics (e.g., interpersonal loss, physical danger, humiliation). If a participant endorsed a stressor, they rated its severity, frequency, timing, and duration. We used two summary scores: 1) total lifetime stressor count and 2) severity for all acute life events and chronic difficulties, with higher scores indicating more frequent stress exposure and greater severity. Prior studies support the psychometric properties of the STRAIN, including excellent test-retest reliability [*r* = 0.90-0.95, @cazassaStressAdversityInventory2020; @slavichAssessingLifetimeStress2018]. Given the format of the STRAIN, which requires participants to endorse whether a stressor occurred to report its severity, Cronbach’s $\alpha$ could not be measured.

## Data analysis

### In-task emotional response ratings

Omnibus ANOVAs tested whether in-task emotion ratings varied as a function of Peer value (high, low) and Feedback type (acceptance, rejection); there was too little between-subject variance to use MLMs to model random intercept. Post-hoc paired samples t-tests compared levels of Peer value and Feedback type. Multiple regression models tested whether behavioral ratings were associated with SES.

### ERP task effects

Omnibus MLMs included random intercept effects of participants and tested whether mean ERP amplitude varied as a function of Peer value (high, low) and Feedback type (acceptance and rejection). See Supplement for these results.

### Multilevel multiple regression models (MLMs)

#### SES related to ERP residualized scores

To compute residualized scores to acceptance, we calculated the unstandardized residuals of brain activity to acceptance, accounting for brain activity to rejection. For aim 1, MLMs tested whether SES was associated with residualized scores to acceptance for each component (RewP~resid~, P300~resid~).

#### SES moderating association between ERP and EMA measures of affect

For aim 2, multilevel multiple regression models tested whether SES moderated associations between ERP amplitudes and EMA ratings of negative/positive affect. These models included random intercept effects of subject and fixed effect of study site. Given a positive skew and large number of zeros in the measure of negative affect, negative affect was cube-root transformed and zero-inflated Gaussian multilevel models were used. All predictors were included in both the conditional and zero-inflation portions of the model. Similar models were used to assess whether SES moderated associations between in-task emotional response ratings and EMA-rated negative affect. All models covaried for site and demographic factors (e.g., age, sex-assigned-at-birth). To test for specificity of effects for SES, analyses also covaried for lifetime stressors (number of stressful life events, severity of stressful life events) and symptoms of depression and anxiety where noted.

# Results

```{r functions including set-model-predictors}
ses_lm <- function(data, y) {
  y <- enquo(y)

  model_formula <- formula(paste0(quo_name(y), "~ ADI_NATRANK_z + site + Age_c + demo_child_sex + StressCT_z + StressTH_z + IDAS_depression_z + IDAS_anxiety_z"))
  lm(model_formula, data = data)
}

apa_printt <- function(model) {
  glue_apa_results(broom::tidy(model, conf.int = TRUE)
    , est_glue = "*t*(<<parameter>>)=<<statistic>>, 95% CI [<<conf.low>>,<<conf.high>>]"
    , stat_glue = "*p*<<add_equals2(p.value)>>"
    , term_names = sanitize_terms(make.names(names(coef(model))))
)
}
```

## In-task emotional response ratings

```{r}
df_BUDS_rating_it_pt <- df_BUDS_rating_it_pt %>%
mutate(site = case_when(ID < 9000 ~ "NYC",
                          ID > 8999 ~ "Chicago"))

ratings_model <- lm(aov(rating ~ site + Feedback*Voting + Error(ID/(Feedback*Voting)), df_BUDS_rating_it_pt)) # wrapping with lm() to make it work with apa_print

df_BUDS_rating_it_pt_wide <- df_BUDS_rating_it_pt %>%
  pivot_wider(id_cols=ID, names_from = c(Feedback, Voting), values_from = rating, values_fn = mean)

ttest_like <- t.test(df_BUDS_rating_it_pt_wide$Accept_Like, df_BUDS_rating_it_pt_wide$Reject_Like, paired=TRUE)
ttest_dislike <- t.test(df_BUDS_rating_it_pt_wide$Accept_Dislike, df_BUDS_rating_it_pt_wide$Reject_Dislike, paired=TRUE)

d_like <- paste0("Cohen's D=",round(cohensD(df_BUDS_rating_it_pt_wide$Accept_Like, df_BUDS_rating_it_pt_wide$Reject_Like, method="paired"),2))
d_dislike <- paste0("Cohen's D=",round(cohensD(df_BUDS_rating_it_pt_wide$Accept_Dislike, df_BUDS_rating_it_pt_wide$Reject_Dislike, method="paired"),2))
```

Omnibus MLMs showed a significant Peer value x Feedback type interaction (`r paste0(substr(apa_printlm(ratings_model)$full_result$FeedbackReject_VotingLike, 0, 40), "*p*< 0.001")`) as participants rated acceptance from high-value peers (i.e., peers that they were interested in) as feeling significantly better than rejection from high-value peers (`r paste0(d_like, ", ", apa_printt(ttest_like)$full_result)`), and participants rated feeling worse in response to acceptance than rejection from low-value peers (`r paste0(d_dislike, ", ", apa_printt(ttest_dislike)$full_result)`). This counter-intuitive behavioral finding calls into question how participants perceived low-value acceptance and rejection. Given these findings and because peer value interacted with feedback for the RewP and P300, further analyses were conducted only for feedback from high-value peers (see Supplement for results and discussion of this counter-intuitive finding for low-value peers).

## Brain responses to peer feedback and socioeconomic status (SES)

### SES associations with RewP~resid~ and P300~resid~

```{r}
rewp_aaar_model <- ses_lm(df_150275_cz,AA_AR_z)
p300_aaar_model <- ses_lm(df_275425_pz,AA_AR_z)
```

Lower SES was significantly related to a more blunted RewP~resid~ and P300~resid~ to acceptance relative to rejection (see Figure 2) over-and-above site, demographic factors (e.g., age, sex-assigned-at-birth), lifetime stressors (number of stressful life events, severity of stressful life events), and symptoms of depression and anxiety. Results are consistent when excluding those who reported that they were not deceived[^1] (see Supplement).

```{r}
load(file=here("../data/BUDS_behavior.RData"))

df_150275_cz_dec <- df_150275_cz_rating %>%
  select(ID, SP_debriefing_deceived_f) %>%
  right_join(df_150275_cz, by="ID")

df_275425_pz_dec <- df_275425_pz_rating %>%
  select(ID, SP_debriefing_deceived_f) %>%
  right_join(df_275425_pz, by="ID")
```

[^1]: Only `r round(sum(df_150275_cz_dec$SP_debriefing_deceived_f==2, na.rm=TRUE)/sum(table(df_150275_cz_dec$SP_debriefing_deceived_f))*100,2)`% of participants with RewP~resid~ data and `r round(sum(df_275425_pz_dec$SP_debriefing_deceived_f==2, na.rm=TRUE)/sum(table(df_275425_pz_dec$SP_debriefing_deceived_f))*100,2)`% of participants with P300~resid~ data stated that they did not believe that they would be chatting with one of the peers from the task (n= `r sum(is.na(df_150275_cz_dec$SP_debriefing_deceived_f))` and `r sum(is.na(df_275425_pz_dec$SP_debriefing_deceived_f))` missing this data, respectively). Given the potential for deception to affect results, we present additional analyses excluding those who did not endorse deception in the Supplement.

### SES moderation of association between RewP~resid~/P300~resid~ and affect

#### Negative Affect

```{r}
model_150275_ema_na <- glmmTMB(na_cubert ~ ADI_NATRANK_z*AA_AR_z + Age_z + demo_child_sex + site + (1 | ID),
                zi = ~ .,
  data = df_150275_cz_ema,
  family=gaussian, REML=TRUE)

model_275425_ema_na <- glmmTMB(na_cubert ~ ADI_NATRANK_z*AA_AR_z + Age_z + demo_child_sex + site + (1 | ID),
                                   zi = ~ .,
  data = df_275425_pz_ema,
  family=gaussian, REML=TRUE)

rewp_na_stat <- c(tidy(model_150275_ema_na) %>% 
                    filter(effect == "fixed", component == "cond", term == "ADI_NATRANK_z:AA_AR_z"),
                  as.data.frame(confint(model_150275_ema_na)) %>% 
                    rownames_to_column("row_name") %>% 
                    filter(row_name == "cond.ADI_NATRANK_z:AA_AR_z") %>% 
                       mutate(lower = round3(`2.5 %`), upper=round3(`97.5 %`)) %>% 
                       select(lower,upper))

p300_na_stat <- c(tidy(model_275425_ema_na) %>%
                    filter(effect == "fixed", component == "cond", term == "ADI_NATRANK_z:AA_AR_z"),
                  as.data.frame(confint(model_275425_ema_na)) %>%
                    rownames_to_column("row_name") %>%
                    filter(row_name == "cond.ADI_NATRANK_z:AA_AR_z") %>%
                       mutate(lower = round3(`2.5 %`), upper=round3(`97.5 %`)) %>%
                       select(lower,upper))
```

```{r}
## REWP
mean_ses <- mean(df_150275_cz$ADI_NATRANK_z, na.rm=TRUE)
sd_ses <- sd(df_150275_cz$ADI_NATRANK_z, na.rm=TRUE)
SES_list <- list(ADI_NATRANK_z=round(c(mean_ses + sd_ses,mean_ses - sd_ses),2)) 

m_rewp_acc <- glmmTMB(na_cubert ~ ADI_NATRANK_z*AA_AR_z + Age_z + demo_child_sex + site + (1 | ID),
        zi = ~ .,
  data = df_150275_cz_ema,
  family=gaussian, REML=TRUE)

m_rewp_acc_ss <- emtrends(m_rewp_acc, pairwise ~ADI_NATRANK_z, var="AA_AR_z",at=SES_list, adjust="none")|> test()

## P300
mean_ses <- mean(df_275425_pz$ADI_NATRANK_z, na.rm=TRUE)
sd_ses <- sd(df_275425_pz$ADI_NATRANK_z, na.rm=TRUE)
SES_list <- list(ADI_NATRANK_z=round(c(mean_ses + sd_ses,mean_ses - sd_ses),2)) 

m_p300_acc <- glmmTMB(na_cubert ~ ADI_NATRANK_z*AA_AR_z + Age_c + demo_child_sex + site + (1 | ID),
        zi = ~ .,
  data = df_275425_pz_ema,
  family=gaussian, REML=TRUE)

m_p300_acc_ss <- emtrends(m_p300_acc, pairwise ~ADI_NATRANK_z, var="AA_AR_z",at=SES_list, adjust="none")|> test()
```

SES significantly moderated the relationship between EMA-assessed negative affect and RewP~resid~ and P300~resid~ to acceptance relative to rejection (Table 2, Figure 3), over-and-above site and demographic factors. Follow-up simple slope analyses showed that no simple slopes were significant for the SES x RewP~resid~ interaction. By contrast, there were significant simple slopes for the SES x P300~resid~, as lower SES was associated with a more negative relationship between P300~resid~ to acceptance relative to rejection and subsequent negative affect. That is, individuals with lower SES who had blunted sensitivity to acceptance exhibited greater negative affect. Results are consistent when excluding those who reported not being deceived (see Supplement). As a test of specificity, we added lifetime stressors and symptoms of depression and anxiety as covariates; the moderation was still significant when these variables were included (see Supplement).

#### Positive Affect
```{r}
# Positive affect
model_150275_ema_pa <- glmmTMB(pa ~ ADI_NATRANK_z*AA_AR_z + Age_c + demo_child_sex + StressCT_z + StressTH_z + site + (1 | ID),
  data = df_150275_cz_ema,
  family=gaussian, REML=TRUE)

model_275425_ema_pa <- glmmTMB(pa ~ ADI_NATRANK_z*AA_AR_z + Age_c + demo_child_sex + StressCT_z + StressTH_z + site + (1 | ID),
  data = df_275425_pz_ema,
  family=gaussian, REML=TRUE)

rewp_pa_stat <- c(tidy(model_150275_ema_pa) %>% 
                    filter(effect == "fixed", component == "cond", term == "ADI_NATRANK_z:AA_AR_z"),
                  as.data.frame(confint(model_150275_ema_pa)) %>% 
                    rownames_to_column("row_name") %>% 
                    filter(row_name == "ADI_NATRANK_z:AA_AR_z") %>%
                       mutate(lower = round(`2.5 %`,2), upper=round(`97.5 %`,2)) %>% 
                       select(lower,upper))

p300_pa_stat <- c(tidy(model_275425_ema_pa) %>%
                    filter(effect == "fixed", component == "cond", term == "ADI_NATRANK_z:AA_AR_z"),
                  as.data.frame(confint(model_275425_ema_pa)) %>%
                    rownames_to_column("row_name") %>%
                    filter(row_name == "ADI_NATRANK_z:AA_AR_z") %>%
                       mutate(lower = round(`2.5 %`,2), upper=round(`97.5 %`,2)) %>%
                       select(lower,upper))
```

SES did not moderate the relationship between positive affect and RewP~resid~ to acceptance ($\beta$=`r rewp_pa_stat$estimate`, 95% CI=[`r paste0(rewp_pa_stat$lower,", ", rewp_pa_stat$upper)`], *p*=`r rewp_pa_stat$p.value`), nor between positive affect and P300~resid~ to acceptance ($\beta$=`r p300_pa_stat$estimate`, 95% CI=[`r paste0(p300_pa_stat$lower,", ", p300_pa_stat$upper)`], *p*=`r p300_pa_stat$p.value`).

# Discussion

The current study found important links between SES and neural response to social feedback—SES was (a) related to aberrant responses to peer acceptance, and (b) moderated the association between neural response to feedback and negative affect assessed outside of the lab. Follow-up analyses indicated that lower SES adolescents who had a more blunted neural response to acceptance (as indicated by a smaller P300~resid~) reported greater daily experiences of negative affect. Importantly, analyses were not due to lifetime stressful life events nor symptoms of depression, highlighting the particular importance of SES. 

## Linking SES to negative affect

The present study provides novel evidence of one potential mechanism for why adolescents with low SES may be at heightened risk for internalizing psychopathology--through a blunted response to positive feedback. There are several potential pathways for this mechanism. One possibility is that low SES environments lead to greater negative affect  [@galloUnderstandingAssociationSocioeconomic2003], which in turn leads to blunted sensitivity to acceptance. A second possibility is that growing up in a low SES environment may make youth less sensitive to positive social feedback, relative to their higher SES peers. This interpersonal sensitivity may then lead to greater daily negative affect, and chronic experiences of negative affect is a robust risk factor for internalizing psychopathology [@minekaComorbidityAnxietyUnipolar1998]. Longitudinal studies have consistently shown that low SES prospectively predicts changes in the way youth report on their relationships [@simonsRelationalSchemasHostile2012; @simonsLearningBeBad2011], and that blunted sensitivity to acceptance is related to depression [@eisenbergerFMRIStudyCytokineinduced2009; @groschwitzDifferentialNeuralProcessing2016; @jankowskiFeelingLeftOut2018; @kumarIncreasedNeuralResponse2017; @beerAnxiouslyElaboratingSocial2016; @guyerLastingAssociationsEarlychildhood2014; @rappaportBrainResponsesSocial2020; @kujawaSocialProcessingEarly2017; @zhangDullSocialAcceptance2017, though see @peggBluntedSocialReward2019 and @rappaportBehavioralPsychiatricCorrelates2024a] and more generally negative affect [@tanAssociationsMaternalNegative2014]. However, as the present study cannot determine the causal direction between SES, brain activity to peer feedback, and daily negative affect, future longitudinal studies are needed to test this and alternative pathways from SES to psychopathology. 

To our knowledge, only one other study examined the association between SES and neural sensitivity to feedback; the present study replicates and expands on this work [@rappaportBehavioralPsychiatricCorrelates2024a]. While both studies were comparable in sample sizes and oversampled individuals with depression, the present study: 1) included a different social feedback task, 2) included a different measure of SES (ADI vs. income-to-needs), 3) had a younger sample (13—18-year-olds), (4) used data from two different, diverse metro areas and, 5) additionally tested whether SES acts in combination with neurobiological patterns to predict behavior outside of the lab. The use of ADI is a particularly notable advance as it may be a more reliable and objective measure of SES than income-to-needs as it (a) is a composite measure that accounts for many aspects of SES rather than a single measure (e.g., education, income) and (b) is derived from census data rather than self-report.

## Limitations

The results of the current study must also be considered in light of several limitations. First, although the area deprivation index provides a rich measure of the neighborhood in which youth are currently living, it does not capture other aspects of adolescents’ environment such as where they spend significant time (e.g., school, after-school activities). Second, we did not assess how long youth had been living at this address; it is possible that some youth had recently moved to their address (although due to low upward mobility in the USA [@chettyEconomicMobility2018] it is unlikely SES dramatically changed). Third, we did not examine how the perceived race or ethnicity of the peer giving feedback impacts brain responses. Half of the feedback came from White peers, while the other half came from peers perceived to be non-White. Thus, we were under-powered to test whether peer perceived race or ethnicity interacted with neural response to feedback. Fourth, one could question the validity of labeling the ERP components we identified as a RewP and P300. These components have, however, been identified in many other studies of social feedback within similar time windows and scalp topographies [@weinbergNeuralResponsesSocial2021; @kujawaSocialProcessingEarly2017; @rappaportBehavioralPsychiatricCorrelates2024a; @distefanoComparisonElectrocorticalResponse2018], and like other studies, we found that ERPs to acceptance were significantly greater than to rejection in the RewP time window but did not differ within the P300 time window [See Supplement, @rappaportBehavioralPsychiatricCorrelates2024a; @peggTimeCourseReactivity2022]. Fifth, we focused on brain response to acceptance residualized for rejection, rather than rejection residualized for acceptance. We did this for two reasons: 1) the RewP is considered to be sensitive to gains rather than losses [@proudfitRewardPositivityBasic2015], and 2) we were concerned that this would unnecessarily increase the number of statistical tests and not provide meaningful additional information. Nonetheless, when we examined responses to rejection residualized for acceptance, we found a similar pattern of results. Future studies could consider including a neutral condition [@peggTimeCourseReactivity2022], however it remains an empirical question what constitutes “neutral” social feedback [@funkhouserSocialFeedbackValence2020].

In conclusion, this study has implications for clinical research on the role of SES in mental health. Recent studies are beginning to elucidate the role and consequences of demographic factors [@correaEthnicDifferencesBehavioral2022] on  mental health symptoms as well as the underlying neurobiological mechanisms [@sheridanChapter13Neurodevelopmental2020; @palacios-barriosPovertySelfregulationConnecting2019; @barchEarlyChildhoodSocioeconomic2022]. Here, we have shown that SES is related to certain neurobiological patterns and that SES in combination with neurobiological patterns can explain some variance in risk to adolescents’ mental health. Clinically, such findings may lead to a better understanding of who is at greatest risk, and more targeted interventions and prevention efforts. For example, prevention and intervention focused on increasing hedonic responses to acceptance in safe, supportive environments may alleviate experiences of negative affect and improve positive affect [@dellacquaLinkingSocialReward2024; @pollakSystematicReviewIntervention2023]. In the absence of societal changes that lift youth out of poverty, understanding how SES interacts with individual vulnerabilities will be integral to addressing the growing youth mental health crisis.

\newpage

# Acknowledgments
The authors would like to thank all participants.

# Disclosures
This work was supported by the National Institute of Mental Health, including R01 MH119771, T32 MH126368, K23 MH129607, and K99 MH133991. The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health. RPA is an unpaid scientific advisor for Ksana Health and is a paid scientific advisor for Get Sonar, Inc. No other authors have conflicts of interest to disclose.

# References

::: {#refs custom-style="Bibliography"}
:::

# Figure Legends
Figure 1. A) Example of trial from chatroom task. B) Grand average ERP for acceptance and rejection feedback from high-value peers and topographic maps. Gray sections of the graph represent time windows where ERP components were extracted at Cz electrode for the RewP (top) and Pz electrode for the P300 (bottom).

Figure 2. Relationship between SES and brain responses to acceptance (relative to rejection) for RewP~resid~ and P300~resid~ ERP components.

Figure 3. Interactions for which SES significantly moderated association between brain responses to acceptance and negative affect. Orange lines = -1 standard deviation below the mean SES; Blue lines = +1 standard deviation above the mean. SES x RewP~resid~ interaction: $\beta$= `r round3(rewp_na_stat$estimate)`, 95% CI = [`r (rewp_na_stat$lower)`,`r (rewp_na_stat$upper)`], p= `r round3(rewp_na_stat$p.value)`; no simple slopes significant. SES x P300~resid~ to acceptance: $\beta$= `r round3(p300_na_stat$estimate)`, 95% CI = [`r (p300_na_stat$lower)`, `r (p300_na_stat$upper)`], p= `r round3(p300_na_stat$p.value)`; Simple slope significant for SES -1 SD.