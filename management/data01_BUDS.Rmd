---
title: "Data prep script 1: Importing and combining self-report data"
author: "Brent Rappaport"
date: "`r format(Sys.time(),  '%Y-%m-%d')`"
output:
  pdf_document: default
  html_document:
    df_print: paged
subtitle: Template Rmd
editor_options:
  chunk_output_type: console
toc: yes
---

# About
This script imports and merges the self-report data from BUDS study: Bullying, Unsupportive family/peers, Discrimination, and Social feedback study using data from PREDICT project collaboration between Northwestern (PI: Shankman) and Columbia (PI: Auerbach).

# Get Setup
## Clear everything & set width
```{r echo=TRUE, results='hide', message=FALSE}
    options(width=80, set.seed=312) #Set width
    rm(list=ls())     #Remove everything from environment
    cat("\014")       #Clear Console
```

## Load Libraries
```{r echo=TRUE, results='hide', message=FALSE}
  library(knitr)      #allows rmarkdown files
  library(haven)      #helps import stata
  library(questionr)  #allows lookfor function
  library(tidyverse)  #plotting/cleaning, etc.
  library(broom)      #nice statistical output
  library(here)       #nice file paths
  library(expss)      #labeling variables/values
  library(psych)      #used for statistical analyses
  library(ggplot2)    #creates plots
  library(Hmisc)
  library(workflowr)  #helps with workflow
```

## Get the Working Directory
```{r}
  here::i_am("management/data01_BUDS.Rmd")
```

## Load Data
Remember to immediately rename and remove. Avoid overwriting old data.
```{r}
# Import data from Columbia University
BUDS_cleaning01_columbia <- read.csv(here("../_rawdata/Columbia/SP_Self-Report_Baseline (3.17.21)_March 6, 2023_13.46.csv"), header=TRUE)
# var.labels = BUDS_cleaning01_columbia[2,]; label(BUDS_cleaning01_columbia) <- var.labels[match(names(BUDS_cleaning01_columbia), names(var.labels))]

BUDS_cleaning02_columbia <- read.csv(here("../_rawdata/Columbia/SP_Self-Report_Baseline (9.2020)_March 1, 2023_07.26.csv"), header=TRUE)
# var.labels = BUDS_cleaning02_columbia[2,]; label(BUDS_cleaning02_columbia) <- var.labels[match(names(BUDS_cleaning02_columbia), names(var.labels))]
BUDS_cleaning03_columbia <- bind_rows(BUDS_cleaning01_columbia, BUDS_cleaning02_columbia)

# Import data from Northwestern University
BUDS_cleaning01_nw1 <- read.csv(here("../_rawdata/Northwestern/SP Self-Report Baseline 9001-9012.csv"), header=TRUE)
# Use the first row as the variable labels
# var.labels = BUDS_cleaning01_nw1[1,]; label(BUDS_cleaning01_nw1) <- var.labels[match(names(BUDS_cleaning01_nw1), names(var.labels))]
BUDS_cleaning02_nw1 <- BUDS_cleaning01_nw1[-(1),]; rm("BUDS_cleaning01_nw1")

BUDS_cleaning01_nw2 <- read.csv(here("../_rawdata/Northwestern/SP Self-Report Baseline 9013-9038.csv"), header=TRUE)
# Use the first row as the variable labels
# var.labels = BUDS_cleaning01_nw2[1,]; label(BUDS_cleaning01_nw2) <- var.labels[match(names(BUDS_cleaning01_nw2), names(var.labels))]
BUDS_cleaning02_nw2 <- BUDS_cleaning01_nw2[-(1),]; rm("BUDS_cleaning01_nw2")

BUDS_cleaning01_nw3 <- read.csv(here("../_rawdata/Northwestern/SP Self-Report Baseline 9039-9100.csv"), header=TRUE)
# Use the first row as the variable labels
# var.labels = BUDS_cleaning01_nw3[1,]; label(BUDS_cleaning01_nw3) <- var.labels[match(names(BUDS_cleaning01_nw3), names(var.labels))]
BUDS_cleaning02_nw3 <- BUDS_cleaning01_nw3[-(1),]; rm("BUDS_cleaning01_nw3")

BUDS_cleaning02_nw <- bind_rows(BUDS_cleaning02_nw1, BUDS_cleaning02_nw2, BUDS_cleaning02_nw3)

BUDS_cleaning02 <- bind_rows(BUDS_cleaning03_columbia, BUDS_cleaning02_nw)
BUDS_cleaning02 <- BUDS_cleaning02 %>%
  mutate(ID = as.integer(id_1_i)) %>%
  filter(!is.na(ID))

# Which subjects have more than 1 row of data?
BUDS_cleaning02[duplicated(BUDS_cleaning02$ID),"ID"]

# CHANGE THIS
# BUDS_cleaning02 <- BUDS_cleaning02 %>%
  # distinct(ID, .keep_all=TRUE)

strain_data <- read.csv(here("../_rawdata/Columbia-NW_SocialProcesses_Lifetime_04-05-23.csv"))
strain_data <- strain_data[-(1:4),]
BUDS_cleaning02_with_strain <- merge(BUDS_cleaning02, strain_data, by="ID")
sort(table(BUDS_cleaning02_with_strain$ID))
```

```{r}
save(BUDS_cleaning02, file=here("data/BUDS_cleaning02.RData"))
save(BUDS_cleaning02_with_strain, file=here("data/BUDS_cleaning02_with_strain.RData"))
```

